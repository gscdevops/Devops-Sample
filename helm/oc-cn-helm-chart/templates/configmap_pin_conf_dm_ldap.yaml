apiVersion: v1
kind: ConfigMap
metadata:
  name: dm-ldap-pin-conf-config
  namespace: {{ .Release.Namespace }}
  labels:
      application: {{ .Chart.Name }}
data:
  pin.conf: |
  
        #************************************************************************
        # Configuration File for LDAP
        #
        #
        # This configuration file is automatically installed and configured with
        # default values during Portal installation. You can edit this file to:
        #   -- change the default values of the entries.
        #   -- disable an entry by inserting a crosshatch (#) at the start of
        #        the line.
        #   -- enable a commented entry by removing the crosshatch (#).
        #
        # Before you make any changes to this file, save a backup copy.
        #
        # When editing this file, follow the instructions in each section.
        # For more information on the general syntax of configuration entries,
        # see "Reference Guide to Portal Configuration Files" in the Portal
        # online documentation.
        #************************************************************************

        #======================================================================
        #
        # You can edit this file to suit your specific configuration:
        #  -- You can change the default values of an entry.
        #  -- You can exclude an optional entry by adding the # symbol
        #     at the beginning of the line.
        #  -- You can include a commented entry by removing the # symbol.
        #
        # Before you make any changes to this file, save a backup copy.
        #
        # To edit this file, follow the instructions in the commented sections.
        # For more information on the general syntax of configuration entries,
        # see "Reference Guide to Portal Configuration Files" in the Portal
        # online documentation.
        #======================================================================
        #=======================================================================
        # ptr_virtual_time
        #
        # Enables the use of pin_virtual_time to advance Portal time, and
        # specifies the shared file for use by all Portal mangers.
        #
        # The entry has 2 values
        #
        # #/Empty       to disable / enable pin_virtual_time in all pin.conf files
        #               default = #     (disable)
        #
        # <filepath>    location and name of the pin_virtual_time file shared by all Portal managers.
        #               default = ${PIN_HOME}/lib/pin_virtual_time_file
        #
        #=======================================================================
        #- - pin_virtual_time ${SHARED_VIRTUAL_TIME_FILE}

        #========================================================================
        # appendZToTimestamp
        #
        # Specifies whether to append the letter Z to the timestamp.
        # Default value is 0 and is valid only if the encoding is UTCTIMESTRING
        #
        # The value for this entry can be:
        #
        #    0 = (Default) Infranet does not append Z.
        #    1 = Infranet appends Z
        #========================================================================
        - ldap_ds       appendZToTimestamp      0


        #========================================================================
        # bind
        #
        # Specifies the Distinguished Name (DN) of the entry used to authenticate
        # Portal to the LDAP directory server.
        #
        # Replace XXX_BIND_DN with the appropriate set of values.
        #
        # The LDAP Data Manager uses the credentials of this entry to connect to
        # the directory server. The specified user ID (uid) must have permission
        # to create and modify entries.
        #
        # For example, you might use:
        #
        #    uid=admin, ou=Administrators, ou=TopologyManagement, o=NetscapeRoot
        #
        # to bind to a Netscape LDAP directory server where the
        #
        #    login uid is admin,
        #    organizational unit (ou) is Administrators,
        #    next-level ou is TopologyManagement, and
        #    organization (o) = NetscapeRoot.
        #
        #========================================================================
        - ldap_ds       bind            ${DM_LDAP_DN_NAME}


        #========================================================================
        # debug
        #
        # Specifies whether the LDAP Data Manager prints debugging information
        # to the dm_ldap.pinlog file.
        #
        # The value for this entry can be:
        #
        #    0 = (Default) Disable debugging
        #    1 = Enable debugging
        #========================================================================
        - ldap_ds       debug           0


        #========================================================================
        # deleteOldRDN
        #
        # Specifies whether to keep the old relative distinguished name of an
        # entry when you rename that entry.
        #
        # The value for this entry can be:
        #
        #    0 = Retain the existing relative distinguished name
        #    1 = (Default) Delete the old relative distinguished name
        #========================================================================
        - ldap_ds       deleteOldRDN    1

        #========================================================================
        # enable_ssl
        #
        # Specifies whether TLS will be enabled for PCM connections
        #
        #    0 - TLS is disabled.
        #    1 - TLS is enabled.
        #
        #========================================================================
        - dm enable_ssl ${ENABLE_SSL}


        #========================================================================
        # encodeTimestamp
        #
        # Specifies the generalized time stamp encoding method.
        #
        # The value for this entry can be:
        #
        #    0 = (Default) UTCTIMESTRING
        #    1 = UTCTIMEVALUE
        #========================================================================
        - ldap_ds       encodeTimestamp         UTCTIMESTRING


        #========================================================================
        # hostname
        #
        # Specifies the name of the computer on which the LDAP directory server
        # runs.
        #
        # Replace "localhost" with the name of the computer that contains the
        # LDAP directory.
        #========================================================================
        - ldap_ds       hostname        ${DM_LDAP_DIRECTORY_SERVER}
        #========================================================================
        # mapping_file
        #
        # Specifies the interface definition language (idl) mapping file that
        # the LDAP Data Manager uses to pass mapping information to
        # Portal.
        #
        # Replace XXX.idl with the name of your mapping file.
        # For the LDAP Manager, the standard name is ldap.idl.
        #========================================================================
        - ldap_ds       mapping_file    ldap.idl


        #========================================================================
        # password
        #
        # Specifies the password for logging on to the LDAP directory server.
        #
        # The bind password, in clear text, authenticates Portal to the
        # directory server during login. Replace XXX_PASSWORD with the password
        # for your directory server.
        #========================================================================
        - ldap_ds       password        ${DM_LDAP_DIRECTORY_SERVER_PASSWORD}


        #========================================================================
        # port
        #
        # Specifies the port number on which the LDAP directory server listens.
        #
        # The standard LDAP directory server port number is 389.
        #========================================================================
        - ldap_ds       port            ${DM_LDAP_DIRECTORY_SERVER_PORT}
        #========================================================================
        # qm_n_fe
        #
        # Specifies the number of front ends the program creates and uses.
        #
        # The allowable range of values is:
        #
        #    Minimum = 1
        #    Maximum = 16
        #
        # Note: For a credit-card processing data manager, set this value to 1.
        #========================================================================
        - dm_ldap qm_n_fe 4


        #========================================================================
        # qm_bigsize
        #
        # (UNIX only) Specifies the size of shared memory for "big" shared-memory
        # structures, such as those used for searches.
        #
        # Note: On Windows NT systems, Portal ignores this entry.
        #
        # The allowable range of values is:
        #
        #    Minimum = 256K
        #    Maximum = 512M
        #
        # This value cannot be more than the value specified in qm_shmsize.
        #
        # If you get memory errors, increase the value.
        #========================================================================
        - dm_ldap qm_bigsize 512k

        #========================================================================
        # Queue Management Debugging
        #
        # The entries below specify which debugging information is printed to the
        # program's log file.
        #
        # qm_debug       = print debugging information for all daemons that use
        #                    queue management
        # qm_debug_front = print debugging information for the front ends of
        #                    this daemon only
        # qm_debug_back  = print debugging information for the back ends of
        #                    this daemon only
        #
        # To use one or more of these entries, remove the crosshatch (#) from the
        # start of the line and enter a valid value or combination of values in
        # hexadecimal format.
        #
        # For the main debugging entry:
        #
        #    1 = Print detailed error information.
        #    2 = Print main loop tracing.
        #    4 = Print transaction tracing.
        #
        # For the front-end and back-end debugging entries:
        #
        #    1 = Print information on new connections.
        #    2 = Print input information.
        #    4 = Print operation done information.
        #    8 = Print output information.
        #========================================================================
        #- dm_ldap qm_debug             0x07    # example: print all debug info
        #- dm_ldap qm_debug_front       0x0F    # example: print all debug info, front end
        #- dm_ldap qm_debug_back                0x0F    # example: print all debug info, back end
        #========================================================================
        # qm_logfile
        #
        # Specifies the full path to the log file used by this Portal process.
        #
        # You can enter any valid path.
        #========================================================================
        - dm_ldap qm_logfile ${PIN_LOG_DIR}/dm_ldap.pinlog


        #========================================================================
        # qm_max_per_fe
        #
        # Specifies the maximum number of connections for each front end.
        #
        # The allowable range of values is:
        #
        #    Minimum = 8
        #    Maximum = 128
        #========================================================================
        - dm_ldap qm_max_per_fe 16

        #========================================================================
        # qm_n_be
        #
        # Specifies the number of back ends the program creates and uses.
        #
        # The allowable range of values is:
        #
        #    Minimum = 1
        #    Maximum = 256
        #
        # Note: For dm_fusa, if you use fusamux, set this value between 4 and 8.
        #       If you don~Rt use fusamux, set this value to 2 (one for a single
        #       batch and one for online processing).
        #========================================================================
        - dm_ldap qm_n_be 8

        #========================================================================
        # qm_port
        #
        # Specifies the hostname/IP address and port number for this process.
        #example
        #- qm_process qm_port myhost.com 1234
        #
        # This number was assigned to this process when you installed Portal. If
        # you change the port, make sure the port number does not conflict with
        # another service. This number must be greater than 1000, unless you start
        # the process as root.
        #
        # The CM configuration file must have a corresponding dm_pointer entry
        # with the same port number.
        #========================================================================
        - dm_ldap qm_port  ${DM_LDAP_SERVICE_HOST} ${DM_LDAP_SERVICE_PORT}


        #========================================================================
        # qm_restart_children
        #
        # Specifies whether to replace child processes.
        #
        # The value for this entry can be:
        #
        #    0 = The DM doesn't replace child processes.
        #    1 = (Default) The DM master process replaces any child DM processes
        #          that fail.
        #
        # You might set this value to 0 for testing, but it should be 1 for
        # production use.
        #========================================================================
        - dm_ldap qm_restart_children 0
        #========================================================================
        # qm_shmsize
        #
        # (UNIX only) Specifies the size of the shared-memory segment that is
        # shared between the front ends and back ends for this Portal process.
        #
        # Note: On Windows NT systems, Portal ignores this entry.
        #
        # Use the suffix "K" to express the memory in kilobytes (units of 1024
        # bytes) or the suffix "M" to express the memory in megabytes (units of
        # 1024 kilobytes). For example, the entry "6M" means 6291456 bytes.
        #
        # The allowable range of values is:
        #
        #    Minimum = 1M
        #    Maximum = 512M
        #
        # Solaris: You must edit the /etc/system file, because the system default
        #     for the maximum allowable shared-memory segment is too low.
        #     See "Problems with memory management" in the online documentation.
        #========================================================================
        - dm_ldap qm_shmsize 4M


        #========================================================================
        # ssl
        #
        # Specifies if the port number on which the LDAP directory server listens
        # is configured to accept TLS connections from dm_ldap .
        #
        # 0 - TLS is disabled in LDAP directory server
        # 1 - TLS is enabled in LDAP directory server
        #
        #========================================================================
        - ldap_ds ssl     0
        #========================================================================
        # ssl_auth_mode
        #
        # Specifies the TLS authentication mode in the LDAP directory server.
        #
        # 0 - TLS authentication is disabled in LDAP directory server.
        # 1 - TLS one way authentication is enabled in LDAP directory server.
        # 2 - TLS two way authentication is enabled in LDAP directory server.
        #
        #========================================================================
        - ldap_ds ssl_auth_mode       1


        #========================================================================
        # wallet
        #
        # Specifies the location of Oracle Wallet used by dm_ldap to
        # communicate with TLS enabled LDAP directory server.
        #
        # NOTE: This wallet stores the certificate of the LDAP directory server.
        #========================================================================
        - ldap_ds wallet      ldap_wallet
  ldap.idl: |
        # Class Definitions:
        # All attributes need to be defined in the directory server
        # All the entry_type objectclasses and attrval objectclasses need to be
        # defined in the directory server.
        #

        STORABLE CLASS /r_user {
                POID PIN_FLD_POID {
                        CREATE = System;
                        MODIFY = System;
                }
                TIMESTAMP PIN_FLD_CREATED_T {
                        CREATE = System;
                        MODIFY = System;
                }
                TIMESTAMP PIN_FLD_MOD_T {
                        CREATE = System;
                        MODIFY = System;
                }
                STRING PIN_FLD_NAME {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                POID PIN_FLD_ACCOUNT_OBJ {
                        CREATE = Required;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_ACCOUNT_NO {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_FIRST_NAME {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_LAST_NAME {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_ACCOUNT_STATUS {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_BILL_TYPE_NAME {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_ADDRESS {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_CURRENCY_NAME {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_LOGIN {
                        CREATE = Required;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_PASSWD {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_EMAIL_LOGIN {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_EMAIL_STATUS {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_IP_LOGIN {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                STRING PIN_FLD_IP_STATUS {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                INT PIN_FLD_MAX_MBOX_SIZE {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                INT PIN_FLD_MAX_MSG_CNT {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                INT PIN_FLD_MAX_MSG_SIZE {
                        CREATE = Optional;
                        MODIFY = Writeable;
                }
                ARRAY PIN_FLD_ARGS {
                        STRING PIN_FLD_ARG {
                                CREATE = Optional;
                                MODIFY = Writeable;
                        }
                }
        }
        STORABLE CLASS /r_user IMPLEMENTATION LDAPV3 {
                ATTRVAL = "objectClass: top";
                ATTRVAL = "objectClass: person";
                ATTRVAL = "objectClass: inetOrgPerson";

                ENTRY_TYPE = "ruser";

                LOCATION = "o=portal.com";

                POID PIN_FLD_POID {
                        ATTRIBUTE = "pinpoid";
                }
                TIMESTAMP PIN_FLD_CREATED_T {
                        ATTRIBUTE = "pincreatedt";
                }
                TIMESTAMP PIN_FLD_MOD_T {
                        ATTRIBUTE = "pinmodt";
                }
                STRING PIN_FLD_NAME {
                        ATTRIBUTE = "cn";
                }
                POID PIN_FLD_ACCOUNT_OBJ {
                        ATTRIBUTE = "billingid";
                }
                STRING PIN_FLD_ACCOUNT_NO {
                        ATTRIBUTE = "accountno";
                }
                STRING PIN_FLD_FIRST_NAME {
                        ATTRIBUTE = "givenName";
                }
                STRING PIN_FLD_LAST_NAME {
                        ATTRIBUTE = "sn";
                }
                STRING PIN_FLD_ACCOUNT_STATUS {
                        ATTRIBUTE = "billingstatus";
                }
                STRING PIN_FLD_BILL_TYPE_NAME {
                        ATTRIBUTE = "billingtype";
                }
                STRING PIN_FLD_ADDRESS {
                        ATTRIBUTE = "billingaddress";
                }
                STRING PIN_FLD_CURRENCY_NAME {
                        ATTRIBUTE = "currency";
                }
                STRING PIN_FLD_LOGIN {
                        ATTRIBUTE = "uid";
                        RDN_PIECE = 1;
                }
                STRING PIN_FLD_PASSWD {
                        ATTRIBUTE = "userPassword";
                }
                STRING PIN_FLD_EMAIL_LOGIN {
                        ATTRIBUTE = "mail";
                }
                STRING PIN_FLD_EMAIL_STATUS {
                        ATTRIBUTE = "mailstatus";
                }
                STRING PIN_FLD_IP_LOGIN {
                        ATTRIBUTE = "iplogin";
                }
                STRING PIN_FLD_IP_STATUS {
                        ATTRIBUTE = "ipstatus";
                }
                INT PIN_FLD_MAX_MBOX_SIZE {
                        ATTRIBUTE = "mailQuota";
                }
                INT PIN_FLD_MAX_MSG_CNT {
                        ATTRIBUTE = "mailmaxmsgcnt";
                }
                INT PIN_FLD_MAX_MSG_SIZE {
                        ATTRIBUTE = "mailmaxmsgsize";
                }
                ARRAY PIN_FLD_ARGS {
                        STRING PIN_FLD_ARG {
                                ATTRIBUTE = "ipargs";
                        MULTIVALUED = 1;
                        }
                }
        }
